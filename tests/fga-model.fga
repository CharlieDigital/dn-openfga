model
  schema 1.1

# See: https://openfga.dev/docs/configuration-language
# Google Drive: https://openfga.dev/docs/modeling/advanced/gdrive
# Entitlements: https://openfga.dev/docs/modeling/advanced/entitlements
# GitHub: https://openfga.dev/docs/modeling/advanced/github

type user

type group
  relations
    define member: [user]         # Direct membership: users can belong to groups
    define team: [team]             # Hierarchy: groups can belong to teamanizations

type team
  relations
    define group: [group]  # groups can belong to teams
    define member: [user] or member from group  # users can be direct members, or members through groups

type form
  relations
    # These are "is" relations
    define reader: [user, group, team]      # Can view/read the form
    define editor: [user, group, team]      # Can modify/edit the form
    define approver: [user, group, team]    # Can approve form submissions
    define publisher: [user, group, team]   # Can publish/make form live

    # These are "can" permissions
    # Read permission: Direct readers OR inheritors from group/team members
    define read: reader or editor or approver or publisher or member from reader or member from editor or member from approver or member from publisher

    # Edit permission: Direct editors OR members of groups/teams that are editors
    define edit: editor or member from editor

    # Approve permission: Direct approvers OR members of groups/teams that are approvers
    define approve: approver or member from approver

    # Publish permission: Direct publishers OR members of groups/teams that are publishers
    define publish: publisher or member from publisher

type document
  relations
    define reader: [user, group, team]      # Can view/read the document
    define editor: [user, group, team]      # Can modify/edit the document
    define approver: [user, group, team]    # Can approve document changes
    define publisher: [user, group, team]   # Can publish/finalize document

    # Read permission: Direct readers OR inheritors from group/team members
    define read: reader or editor or approver or publisher or member from reader or member from editor or member from approver or member from publisher

    # Edit permission: Direct editors OR members of groups/teams that are editors
    define edit: editor or member from editor

    # Approve permission: Direct approvers OR members of groups/teams that are approvers
    define approve: approver or member from approver

    # Published permission: Direct publishers OR members of groups/teams that are publishers
    define publish: publisher or member from publisher

# Use case for CRM: https://usemotion.slack.com/archives/C061E0G4CTV/p1759015002088959

type crm_company
  relations
    # Define the relations and the type of accessors
    define reader: [user, group, team]
    define editor: [user, group, team]
    define owner: [user, group, team]

    # Define the permissions and the members associated with the permission
    define read: reader or editor or owner or member from reader or member from editor or member from owner
    define edit: editor or member from editor or member from owner
    define owns: owner or member from owner

type crm_person
  relations
    define parent: [crm_company]
    define reader: [user, group, team]
    define editor: [user, group, team]

    # Inherit permissions from the parent company
    define read: reader or editor or read from parent or edit from parent or owns from parent
    define edit: editor or edit from parent or owns from parent
    define owns: owns from parent
